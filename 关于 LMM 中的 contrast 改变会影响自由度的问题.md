# 关于 LMM 中的 contrast 改变会影响自由度的问题
用 `R` 的 `lmer` 进行混合线性模型时，会注意到**固定效应** (**Fixed Effects**) 的自由度是小数，且当变化比较的基线时(`contrasts()`)，自由度会变化，
从而改变了显著性。本人查了一些资料，可以**定性**地解释一下这样的原因 (**正在持续查找资料，如果查到了会及时更新**)，以及一些**不成熟**的建议。

## 混合线性模型的自由度计算
先来一个例子：
```
aov2 = lmer(scale(FFD ~ CondA * CondB + (1|Sub) + (1|Item))
fit2 = summary(aov2); fit2$coefficients
```
其固定因子为
```
                Estimate Std. Error         df   t value     Pr(>|t|)
(Intercept)   -0.1304765 0.06181545   85.31114 -2.110742 3.772169e-02
CondA1         0.2506328 0.05425985 2330.96835  4.619121 4.063478e-06
CondB1         0.1711889 0.05439903 2332.09217  3.146911 1.670882e-03
CondA1:CondB1 -0.3261056 0.07693112 2331.65448 -4.238929 2.333350e-05
```
查看 `CondB` 的比较水平
```
contrasts(CondB)
```
结果为
```
   [,1]
B1    0
B2    1
```
调整 `CondB` 的基线水平，并查看新的结果
```
contrasts(CondB) = c(1, 0)
fit2 = summary(aov2)
fit2$coefficients
```
结果为
```
                Estimate Std. Error         df   t value     Pr(>|t|)
(Intercept)   -0.1304765 0.06181545   84.61276 -2.115262 3.734809e-02
CondA1         0.2506328 0.05425985 2332.23625  4.596164 4.533009e-06
CondB1         0.1711889 0.05439903 2332.09215  3.146911 1.670882e-03
CondA1:CondB1 -0.3261056 0.07693112 2331.65446 -4.238929 2.333350e-05
```
注意到**自由度发生微小的变化且是小数**，
这是因为**目前`R` `SPSS` `JAMOVI`都是用`Satthwaite 近似估计值`方法计算，
基于的是 residual variance (我的理解是因变量在每个 `group` 里的离散程度)**，
具体的算法就不写了，矩阵运算很复杂。

**因为是估计值，所以带小数。**

**同时因为是矩阵运算，所以会用到秩运算，改变对比的基线，秩会改变。**
虽然**理论上最后的结果不会发生变化**，但是前面说到了是估计值，而且 `R` 这样的编程程序在细微的计算上总是有很小的误差的
(一个简单的例子 `sin(pi)` 的结果 就不是 0)。

理论上改变前后结果的差别应该不大，但是如果 p 边缘显著的话，那就比较头大了
(改变基线前还是不显著的, 改变之后就显著了)。

## 一些**不成熟**的个人意见
如果出现上面说的情况，
个人认为**一定要确定选择谁作为基线的理由**，比如一些理论和实证研究的支持，
总之要坚持实事求是的原则，不要为了显著而可以设置到显著的基线水平，
因为既然结果不稳定，说明效应本来就不大，就不要 "霸王硬上弓" 了......

如果是单因素，可以采用简单效应分析来确定。关于简单效应分析请移步下面这篇文章：

[如何用 R 做混合线性模型 (linear mixed model) 的 简单效应分析？](https://www.zhihu.com/question/276113693/answer/385199868)  
注意其中的 `pairwise` 参数 应该设置为 `pairwise = CondA`
(假设只有CondA一个因素)。

## 固定效应自由度的计算
关于计算方法，以下是一些教材的汇总，在此感谢室友[包寒吴霜](https://www.zhihu.com/people/psychbruce/activities)的支持。

[关于混合线性模型中固定效应自由度的计算](https://github.com/usplos/self-programming/blob/master/HLM%20df.docx?raw=true)
